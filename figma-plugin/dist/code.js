/*! For license information please see code.js.LICENSE.txt */
(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){"use strict";e=function(){return n};var r,n={},a=Object.prototype,o=a.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",f=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(r){l=function(t,e,r){return t[e]=r}}function p(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,o=Object.create(a.prototype),s=new j(n||[]);return i(o,"_invoke",{value:M(t,r,s)}),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}n.wrap=p;var g="suspendedStart",y="suspendedYield",m="executing",d="completed",v={};function b(){}function w(){}function x(){}var k={};l(k,c,(function(){return this}));var E=Object.getPrototypeOf,L=E&&E(E(C([])));L&&L!==a&&o.call(L,c)&&(k=L);var S=x.prototype=b.prototype=Object.create(k);function P(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function I(e,r){function n(a,i,s,c){var u=h(e[a],e,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==t(l)&&o.call(l,"__await")?r.resolve(l.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):r.resolve(l).then((function(t){f.value=t,s(f)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(t,e){function o(){return new r((function(r,a){n(t,e,r,a)}))}return a=a?a.then(o,o):o()}})}function M(t,e,n){var a=g;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===d){if("throw"===o)throw i;return{value:r,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var c=_(s,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===g)throw a=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=h(t,e,n);if("normal"===u.type){if(a=n.done?d:y,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=d,n.method="throw",n.arg=u.arg)}}}function _(t,e){var n=e.method,a=t.iterator[n];if(a===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,_(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=h(a,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,v;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,v):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function C(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(o.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return w.prototype=x,i(S,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:w,configurable:!0}),w.displayName=l(x,f,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,f,"GeneratorFunction")),t.prototype=Object.create(S),t},n.awrap=function(t){return{__await:t}},P(I.prototype),l(I.prototype,u,(function(){return this})),n.AsyncIterator=I,n.async=function(t,e,r,a,o){void 0===o&&(o=Promise);var i=new I(p(t,e,r,a),o);return n.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(S),l(S,f,"Generator"),l(S,c,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},n.values=C,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,a){return s.type="throw",s.arg=t,e.next=n,a&&(e.method="next",e.arg=r),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),v}},n}function r(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,a)}function n(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var i=t.apply(e,n);function s(t){r(i,a,o,s,c,"next",t)}function c(t){r(i,a,o,s,c,"throw",t)}s(void 0)}))}}var a=!1,o=null,i="ws://localhost:9000",s={},c=0,u={aiModel:"claude-3-sonnet",designStyle:"modern"};function f(){return(f=n(e().mark((function t(){var r,n;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,figma.clientStorage.getAsync("settings");case 3:if(r=t.sent){for(n in r)r.hasOwnProperty(n)&&(u[n]=r[n]);r.serverUrl&&(i=r.serverUrl)}t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("설정 로드 오류:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}function l(t){return p.apply(this,arguments)}function p(){return(p=n(e().mark((function t(r){var n;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n in t.prev=0,r)r.hasOwnProperty(n)&&(u[n]=r[n]);return t.next=4,figma.clientStorage.setAsync("settings",u);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.error("설정 저장 오류:",t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))).apply(this,arguments)}var h={colors:{primary:{r:.1,g:.1,b:.9,a:1},secondary:{r:.2,g:.2,b:.7,a:1},accent:{r:.9,g:.2,b:.2,a:1},text:{r:.1,g:.1,b:.1,a:1},background:{r:1,g:1,b:1,a:1},gray:{r:.9,g:.9,b:.9,a:1}},text:{heading:{fontName:{family:"Inter",style:"Bold"},fontSize:32},subheading:{fontName:{family:"Inter",style:"SemiBold"},fontSize:24},body:{fontName:{family:"Inter",style:"Regular"},fontSize:16},caption:{fontName:{family:"Inter",style:"Regular"},fontSize:12}},spacing:{small:8,medium:16,large:24,xlarge:40}};function g(t,e){return new Promise((function(r,n){if(a){var o="req_"+c+++"_"+Date.now();s[o]={resolve:r,reject:n,time:Date.now()},figma.ui.postMessage({type:"sendWSCommand",requestId:o,command:t,params:e||{}}),setTimeout((function(){if(s[o]){var e=new Error("명령 타임아웃: "+t);s[o].reject(e),delete s[o]}}),15e3)}else n(new Error("MCP 서버에 연결되어 있지 않습니다"))}))}function y(t,e){return m.apply(this,arguments)}function m(){return(m=n(e().mark((function t(r,n){var o,i;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r){t.next=5;break}return figma.notify("템플릿이 지정되지 않았습니다"),figma.ui.postMessage({type:"generationFailed",error:"템플릿이 지정되지 않았습니다"}),t.abrupt("return");case 5:if(figma.notify("포트폴리오 생성 중..."),(o=figma.createPage()).name=n.name||"포트폴리오",figma.currentPage=o,!a){t.next=26;break}return t.prev=10,t.next=13,g("generatePortfolio",{templateId:r,data:n});case 13:return i=t.sent,figma.notify("포트폴리오가 생성되었습니다!"),figma.ui.postMessage({type:"generationSuccess"}),t.abrupt("return",i);case 19:t.prev=19,t.t0=t.catch(10),console.error("포트폴리오 생성 중 오류:",t.t0),figma.notify("오류: "+t.t0.message),figma.ui.postMessage({type:"generationFailed",error:t.t0.message});case 24:t.next=32;break;case 26:return t.next=28,x({template:{id:r,name:n.name||"포트폴리오"},data:n});case 28:return i=t.sent,figma.notify("포트폴리오가 생성되었습니다!"),figma.ui.postMessage({type:"generationSuccess"}),t.abrupt("return",i);case 32:t.next=39;break;case 34:t.prev=34,t.t1=t.catch(0),console.error("포트폴리오 생성 중 오류:",t.t1),figma.notify("오류: "+t.t1.message),figma.ui.postMessage({type:"generationFailed",error:t.t1.message});case 39:case"end":return t.stop()}}),t,null,[[0,34],[10,19]])})))).apply(this,arguments)}function d(t){return v.apply(this,arguments)}function v(){return(v=n(e().mark((function t(r){var n,a,o,i,s,c,u;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.name||"New Frame",a=r.width||800,o=r.height||600,i=r.x||0,s=r.y||0,c=r.backgroundColor||h.colors.background,(u=figma.createFrame()).name=n,u.resize(a,o),u.x=i,u.y=s,u.fills=[{type:"SOLID",color:c}],figma.currentPage.appendChild(u),t.abrupt("return",{id:u.id,name:u.name});case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(t){return w.apply(this,arguments)}function w(){return(w=n(e().mark((function t(r){var n,a,o,i,s,c,u,f,l,p,g;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.text||"",a=r.frameId,o=r.x||0,i=r.y||0,s=r.width||300,c=r.styleType||"body",u=r.color||h.colors.text,f=r.horizontalAlignment||"LEFT",l=h.text[c]||h.text.body,(p=figma.createText()).characters=n,p.x=o,p.y=i,p.resize(s,p.height),p.textAlignHorizontal=f,t.next=17,figma.loadFontAsync(l.fontName);case 17:return p.fontName=l.fontName,p.fontSize=l.fontSize,p.fills=[{type:"SOLID",color:u}],a&&(g=figma.getNodeById(a))&&"FRAME"===g.type?g.appendChild(p):figma.currentPage.appendChild(p),t.abrupt("return",{id:p.id,text:p.characters});case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t){return k.apply(this,arguments)}function k(){return(k=n(e().mark((function t(r){var n,a,o;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.template,a=r.data,t.next=4,d({name:a&&a.name||n&&n.name||"포트폴리오",width:1920,height:1080,backgroundColor:h.colors.background});case 4:return o=t.sent,t.next=7,b({frameId:o.id,text:(a.name||"포트폴리오")+" - "+(a.designer||"디자이너"),x:50,y:50,width:500,styleType:"heading"});case 7:return t.abrupt("return",o);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}figma.showUI(__html__,{width:400,height:500}),function(){return f.apply(this,arguments)}().then((function(){a&&figma.ui.postMessage({type:"connected"})})),figma.ui.onmessage=function(){var t=n(e().mark((function t(r){var n;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("UI 메시지 수신:",r.type),t.t0=r.type,t.next="wsConnected"===t.t0?4:"wsDisconnected"===t.t0?10:"wsConnectionEstablished"===t.t0?14:"wsError"===t.t0?17:"wsCommandResult"===t.t0?20:"wsCommandError"===t.t0?23:"connect"===t.t0?26:"disconnect"===t.t0?28:"generatePortfolio"===t.t0?30:"getSettings"===t.t0?33:"saveSettings"===t.t0?35:"portfolioGenerated"===t.t0?40:"notify"===t.t0?42:"close-plugin"===t.t0?44:46;break;case 4:return a=!0,i=r.serverUrl,t.next=8,l({serverUrl:i});case 8:return figma.notify("MCP 서버에 연결되었습니다"),t.abrupt("break",46);case 10:return a=!1,o=null,figma.notify("MCP 서버와의 연결이 종료되었습니다"),t.abrupt("break",46);case 14:return o=r.connectionId,figma.notify("MCP 서버에 연결되었습니다. (ID: "+o+")"),t.abrupt("break",46);case 17:return a=!1,figma.notify("MCP 서버 연결 오류: "+r.error),t.abrupt("break",46);case 20:return(n=s[r.requestId])&&(n.resolve(r.result),delete s[r.requestId]),t.abrupt("break",46);case 23:return(n=s[r.requestId])&&(n.reject(new Error(r.error)),delete s[r.requestId]),t.abrupt("break",46);case 26:return figma.ui.postMessage({type:"connect",serverUrl:r.serverUrl||i}),t.abrupt("break",46);case 28:return figma.ui.postMessage({type:"disconnect"}),t.abrupt("break",46);case 30:return t.next=32,y(r.templateId,{name:r.portfolioName,designer:r.designerName});case 32:return t.abrupt("break",46);case 33:return figma.ui.postMessage({type:"settings",aiModel:u.aiModel,designStyle:u.designStyle}),t.abrupt("break",46);case 35:if(!r.settings){t.next=39;break}return t.next=38,l(r.settings);case 38:figma.notify("설정이 저장되었습니다");case 39:return t.abrupt("break",46);case 40:return figma.notify("포트폴리오가 생성되었습니다!"),t.abrupt("break",46);case 42:return figma.notify(r.message),t.abrupt("break",46);case 44:return figma.closePlugin(r.message),t.abrupt("break",46);case 46:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),figma.on("run",(function(t){switch(t.command){case"generate-portfolio":figma.ui.postMessage({type:"show-generator"});break;case"connect-mcp":figma.ui.postMessage({type:"show-connect"});break;case"show-settings":figma.ui.postMessage({type:"show-settings"})}}))})();