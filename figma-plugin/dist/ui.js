document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("main-view"),t=document.getElementById("generator-view"),n=document.getElementById("connect-view"),s=document.getElementById("settings-view"),c=document.getElementById("connection-status"),o=document.getElementById("template-container");let a=!1,d=[];function l(c){[e,t,n,s].forEach((e=>{e&&(e.style.display="none")})),c&&(c.style.display="block")}function i(){c&&(c.textContent=a?"연결됨":"연결 안됨",c.className=a?"status-connected":"status-disconnected")}function m(e){o&&(o.innerHTML="",e&&0!==e.length?e.forEach((e=>{const t=document.createElement("div");t.className="template-card",t.dataset.templateId=e.id,t.innerHTML=`\n        <h3>${e.name}</h3>\n        <p>${e.description}</p>\n      `,t.addEventListener("click",(()=>{document.querySelectorAll(".template-card").forEach((e=>{e.classList.remove("selected")})),t.classList.add("selected")})),o.appendChild(t)})):r())}function r(){m([{id:"minimalist",name:"미니멀리스트",description:"깔끔하고 간결한 디자인"},{id:"project-showcase",name:"프로젝트 쇼케이스",description:"프로젝트 중심 레이아웃"},{id:"creative",name:"크리에이티브",description:"창의적이고 예술적인 디자인"}])}function u(e,t="info"){const n=document.getElementById("notification");n&&(n.textContent=e,n.className=`notification notification-${t}`,n.style.display="block",setTimeout((()=>{n.style.display="none"}),3e3))}l(e),i(),document.getElementById("create-portfolio-btn").addEventListener("click",(()=>{l(t),a?parent.postMessage({pluginMessage:{type:"getTemplates"}},"*"):r()})),document.getElementById("connect-btn").addEventListener("click",(()=>{l(n)})),document.getElementById("settings-btn").addEventListener("click",(()=>{l(s)})),document.getElementById("connect-server-btn").addEventListener("click",(()=>{const e=document.getElementById("server-url").value;e&&(parent.postMessage({pluginMessage:{type:"connect",serverUrl:e}},"*"),document.getElementById("connect-status").textContent="연결 중...",document.getElementById("connect-status").className="status-connecting")})),document.getElementById("disconnect-btn").addEventListener("click",(()=>{parent.postMessage({pluginMessage:{type:"disconnect"}},"*")})),document.getElementById("save-settings-btn").addEventListener("click",(()=>{const t=document.getElementById("ai-model").value,n=document.getElementById("design-style").value;parent.postMessage({pluginMessage:{type:"saveSettings",settings:{aiModel:t,designStyle:n}}},"*"),l(e)})),document.querySelectorAll(".back-btn").forEach((t=>{t.addEventListener("click",(()=>{l(e)}))})),document.getElementById("generate-btn").addEventListener("click",(()=>{const e=document.getElementById("portfolio-name").value||"포트폴리오",t=document.getElementById("designer-name").value||"디자이너 이름",n=document.querySelector(".template-card.selected");if(!n)return void u("템플릿을 선택해주세요","error");const s=n.dataset.templateId;parent.postMessage({pluginMessage:{type:"generatePortfolio",portfolioName:e,designerName:t,templateId:s}},"*"),document.getElementById("generate-btn").disabled=!0,document.getElementById("generate-btn").textContent="생성 중..."})),window.onmessage=t=>{const n=t.data.pluginMessage;if(n)switch(n.type){case"connectionSuccess":a=!0,i(),document.getElementById("connect-status").textContent="연결 성공!",document.getElementById("connect-status").className="status-success",setTimeout((()=>l(e)),1500);break;case"connectionFailed":a=!1,i(),document.getElementById("connect-status").textContent=`연결 실패: ${n.error}`,document.getElementById("connect-status").className="status-error";break;case"disconnected":a=!1,i(),document.getElementById("connect-status").textContent="연결 해제됨",document.getElementById("connect-status").className="status-normal",setTimeout((()=>l(e)),1500);break;case"templatesList":d=n.templates,m(d);break;case"generationSuccess":document.getElementById("generate-btn").disabled=!1,document.getElementById("generate-btn").textContent="포트폴리오 생성",u("포트폴리오가 성공적으로 생성되었습니다!","success"),setTimeout((()=>l(e)),1500);break;case"generationFailed":document.getElementById("generate-btn").disabled=!1,document.getElementById("generate-btn").textContent="포트폴리오 생성",u(`생성 실패: ${n.error}`,"error");break;case"notify":u(n.message,n.level||"info")}}}));