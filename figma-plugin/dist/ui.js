document.addEventListener("DOMContentLoaded",(function(){var e={main:document.getElementById("main-view"),generator:document.getElementById("generator-view"),connect:document.getElementById("connect-view"),settings:document.getElementById("settings-view")},t=document.getElementById("status-indicator"),n=document.getElementById("status-text"),s=document.getElementById("template-container"),a="http://localhost:9000",o=!1,c=0;function i(e){fetch(e+"/ping",{method:"GET",headers:{Accept:"application/json"}}).then((function(e){if(e.ok)return e.json();throw new Error("서버 응답이 올바르지 않습니다")})).then((function(t){o=!0,m(),document.getElementById("connection-success").textContent="MCP 서버에 연결되었습니다.",document.getElementById("connection-success").style.display="block",parent.postMessage({pluginMessage:{type:"connected",serverUrl:e}},"*"),setTimeout((function(){l("main")}),1500)})).catch((function(e){console.error("연결 테스트 오류:",e),o=!1,m(),document.getElementById("connection-error").textContent="서버 연결 오류: "+e.message,document.getElementById("connection-error").style.display="block",parent.postMessage({pluginMessage:{type:"connectionFailed",error:e.message}},"*")}))}function d(){var e;o&&(o=!1,m(),parent.postMessage({pluginMessage:{type:"disconnected"}},"*"),e="서버 연결이 해제되었습니다",console.log("알림:",e),parent.postMessage({pluginMessage:{type:"notify",message:e}},"*"))}function r(e,t){return new Promise((function(n,s){if(o){var i={commandId:"req_"+c+++"_"+Date.now(),command:e,params:t||{}};fetch(a+"/api/command",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}).then((function(e){if(e.ok)return e.json();throw new Error("서버 응답이 올바르지 않습니다")})).then((function(e){e.error?s(e.error):n(e.result)})).catch((function(e){s(e.message)}))}else s("MCP 서버에 연결되어 있지 않습니다")}))}function l(t){for(var n in e)e.hasOwnProperty(n)&&e[n].classList.remove("active");e[t].classList.add("active")}function m(){o?(t.classList.remove("disconnected"),t.classList.add("connected"),n.textContent="연결됨"):(t.classList.remove("connected"),t.classList.add("disconnected"),n.textContent="연결 끊김")}function g(){u([{id:"minimalist",name:"미니멀리스트",description:"깔끔하고 심플한 디자인"},{id:"project-showcase",name:"프로젝트 쇼케이스",description:"작업물과 프로젝트를 강조"},{id:"creative",name:"크리에이티브",description:"창의적이고 예술적인 감각"}])}function u(e){if(s){s.innerHTML="";for(var t=0;t<e.length;t++){var n=e[t],a=document.createElement("div");a.className="template-card",a.dataset.template=n.id,a.innerHTML="<h3>"+n.name+"</h3><p>"+n.description+"</p>",a.addEventListener("click",(function(e){for(var t=document.querySelectorAll(".template-card"),n=0;n<t.length;n++)t[n].classList.remove("selected");this.classList.add("selected")})),s.appendChild(a)}}}l("main"),m(),document.getElementById("create-portfolio-btn").addEventListener("click",(function(){l("generator"),o?r("getTemplates",{}).then((function(e){e&&e.templates?u(e.templates):g()})).catch((function(e){console.error("템플릿 가져오기 오류:",e),g()})):g()})),document.getElementById("connect-btn").addEventListener("click",(function(){l("connect")})),document.getElementById("settings-btn").addEventListener("click",(function(){l("settings"),parent.postMessage({pluginMessage:{type:"getSettings"}},"*")})),document.getElementById("connect-server-btn").addEventListener("click",(function(){var e=document.getElementById("server-url").value;a=e.startsWith("ws://")?e.replace("ws://","http://"):e.startsWith("wss://")?e.replace("wss://","https://"):e.startsWith("http://")||e.startsWith("https://")?e:"http://"+e,document.getElementById("connection-error").style.display="none",document.getElementById("connection-success").style.display="none",i(a)})),document.getElementById("disconnect-server-btn").addEventListener("click",(function(){d()})),document.getElementById("save-settings-btn").addEventListener("click",(function(){var e=document.getElementById("ai-model").value,t=document.getElementById("design-style").value;parent.postMessage({pluginMessage:{type:"saveSettings",settings:{aiModel:e,designStyle:t,serverUrl:a}}},"*"),l("main")})),document.getElementById("generator-back-btn").addEventListener("click",(function(){l("main")})),document.getElementById("connect-back-btn").addEventListener("click",(function(){l("main")})),document.getElementById("settings-back-btn").addEventListener("click",(function(){l("main")})),document.getElementById("generate-btn").addEventListener("click",(function(){var e=document.getElementById("portfolio-name").value||"포트폴리오",t=document.getElementById("designer-name").value||"디자이너 이름",n=document.querySelector(".template-card.selected");if(n){var s=n.dataset.template;document.getElementById("generate-btn").disabled=!0,document.getElementById("generate-btn").textContent="생성 중...",o?r("generatePortfolio",{templateId:s,data:{name:e,designer:t}}).then((function(e){parent.postMessage({pluginMessage:{type:"portfolioGenerated",result:e}},"*"),document.getElementById("generate-btn").disabled=!1,document.getElementById("generate-btn").textContent="포트폴리오 생성",setTimeout((function(){l("main")}),1500)})).catch((function(e){document.getElementById("generate-btn").disabled=!1,document.getElementById("generate-btn").textContent="포트폴리오 생성",parent.postMessage({pluginMessage:{type:"notify",message:"생성 실패: "+e}},"*")})):parent.postMessage({pluginMessage:{type:"generatePortfolio",templateId:s,portfolioName:e,designerName:t}},"*")}else parent.postMessage({pluginMessage:{type:"notify",message:"템플릿을 선택해주세요"}},"*")})),window.onmessage=function(e){var t=e.data.pluginMessage;if(t)switch(t.type){case"connect":if(t.serverUrl){var n=t.serverUrl;n.startsWith("ws://")?n=n.replace("ws://","http://"):n.startsWith("wss://")?n=n.replace("wss://","https://"):n.startsWith("http://")||n.startsWith("https://")||(n="http://"+n),i(n)}break;case"disconnect":d();break;case"templatesList":t.templates&&t.templates.length>0&&u(t.templates);break;case"settings":document.getElementById("ai-model").value=t.aiModel||"claude-3-sonnet",document.getElementById("design-style").value=t.designStyle||"modern";break;case"generationSuccess":document.getElementById("generate-btn").disabled=!1,document.getElementById("generate-btn").textContent="포트폴리오 생성",setTimeout((function(){l("main")}),1500);break;case"generationFailed":document.getElementById("generate-btn").disabled=!1,document.getElementById("generate-btn").textContent="포트폴리오 생성";break;case"show-connect":l("connect");break;case"show-generator":l("generator");break;case"show-settings":l("settings")}}}));